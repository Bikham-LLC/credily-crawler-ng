<div class="searchRowMain mt-3">
    <div class="row align-items-center justify-content-between">
        <div class="col-lg-3">
                <div class="position-relative">
                  <input id="searchname" name="searchname" placeholder="Search" class="form-control" style="padding:0px 15px 0px 38px"
                  [(ngModel)]="databaseHelper.search" (ngModelChange)="this.providerSearch.next($event)"/>
                    <i class="bi bi-search search-icon"></i>
                </div>
        </div>
        <div class="col-lg-9">
            <div class="d-flex justify-content-end align-items-center gap-2">
              <div class="col-lg-3">
                <div class="dateRangeFilter">
                    <input type="text" autocomplete="off" class="form-control" name="daterange" placeholder="Select Date Range" ngxDaterangepickerMd [showClearButton]="true" [opens]="'left'" [locale]="{applyLabel: 'Apply', format: 'MM-DD-YYYY'}" [(ngModel)]="selected" (ngModelChange)="selectDateFilter($event)">
                </div>
            </div>
                <button type="button" class="tblFilterBtn" [ngClass]="{'tblFilterBtnactive': filterType == 'completed'}" (click)="getProviderReport('completed')">
                    <i class="bi bi-check2"></i>
                    Completed
                    <span class="filterCount bg-success text-white" >{{completedCount}}</span>
                </button>
                <button type="button" class="tblFilterBtn" [ngClass]="{'tblFilterBtnactive': filterType == 'partiallyCompleted'}" (click)="getProviderReport('partiallyCompleted')">
                    <i class="bi bi-exclamation-triangle"></i>
                    Partially Completed
                    <span class="filterCount bg-warning">{{partiallyCompletedCount}}</span>
                </button>
            </div>
        </div>
    </div>
</div>

<div class="usertable mt-3 ng-star-inserted">
    <div class="usertableinner table-responsive">
        <table class="table" *ngIf="providerReports.length>0 && !fetchingReport">
            <thead>
                <tr>
                    <th style="width: 15%;">
                        <span style="cursor: pointer;"> Provider Name <i class="bi bi-arrow-down-up"></i></span>
                    </th>
                    <th style="width: 13%;">NPI Number</th>
                    <th style="width: 15%;">Email</th>
                    <th style="width: 9%;">Phone</th>
                    <th style="width: 8%;">
                        <span style="cursor: pointer;"> Version <i class="bi bi-arrow-down-up"></i></span>
                    </th>
                    <th style="width: 12%;">Updated Date</th>
                    <th style="width: 12%;">Status</th>
                    <th style="width: 10%;">Logs</th>
                </tr>
            </thead>
            
            <tbody>
                <tr *ngFor="let obj of providerReports; let i = index">
                    <td>
                        <div class="tableinfo">{{obj.providerName}}</div>
                    </td>
                    <td>
                        <div class="tableinfo">
                            <span class="badge-grey npi-badge">{{obj.npi}}</span>
                        </div>
                    </td>
                    <td>
                        <div class="tableinfo textClamp">{{obj.email}}</div>
                    </td>
                    <td>
                        <div class="tableinfo ">
                            {{obj.phone}}
                        </div>
                    </td>
                    <td>
                        <div class="tableinfo ">
                            {{obj.version}}
                        </div>
                    </td>
                   
                    <td>
                        <div class="tableinfo text-muted">
                            {{obj.updatedDate | date:'MM/dd/yyyy, hh:mm:a'}}
                        </div>
                    </td>
                    <td>
                        <div class="tableinfo">
                            <span class=" mx-auto"><span
                                [ngClass]="{'statusactive':obj.status.toUpperCase()=='COMPLETED', 'statusinactive':obj.status =='NO CONFIG FOUND', 'statuspending':(obj.status.toUpperCase()!='COMPLETED' && obj.status.toUpperCase()!='NO CONFIG FOUND') }">
                                {{obj.status | titlecase}}
                              </span></span>
                        </div>
                    </td>
                    
                    <td>
                        <div class="tableinfo">
                            <div class="d-flex align-items-center gap-2">
                                <button type="button" class="btn primarybtn" (click)="viewLogs(obj.providerUuid)">View</button>
                                <!-- <span *ngIf="Constant.REFRESH_HIDE.includes(obj.status)" (click)="refreshProviderStatus(obj.providerUuid, i)">
                                  <i *ngIf="!providerReports[i].refreshProviderLoading" class="bi bi-arrow-repeat" style="font-size: 17px;color: #003fdaeb;"></i>
                                  <i *ngIf="providerReports[i].refreshProviderLoading"class="spinner-border spinner-border-sm" style="color: #003fdaeb;"></i>
                                </span> -->
                            </div>
                        </div>
                    </td>
                    
                </tr>
            </tbody>
        </table>
        <app-circular-loader *ngIf="fetchingReport"></app-circular-loader>
        <div class="paginationmain mt-5" *ngIf=" !fetchingReport && providerReports.length >0">
          <div class="d-flex align-items-center justify-content-between">
            <p class="currentshowing mb-0">
              Showing <span>{{providerReports.length}}</span> of <span>{{totalProviderReport}}</span>
            </p>
            <div class="col-lg-6">
              <div class="card-body d-flex justify-content-end">
                <ngb-pagination class="pagination pagination-separated justify-content-sm-end mb-sm-0"
                  [collectionSize]="totalProviderReport" [rotate]="true" (pageChange)="pageChanged($event)"
                  [pageSize]="databaseHelper.itemsPerPage" [(page)]="databaseHelper.currentPage" [maxSize]="5"
                  [boundaryLinks]="true">
                </ngb-pagination>
              </div>
            </div>
          </div>
        </div>
        <!-- Empty notification -->
        <div class="empty-notific text-center" style="margin: 13% 10% 13% 3%;"
        *ngIf="!fetchingReport && providerReports.length==0">
        <div class="empty-notificinner">

          <img src="assets/images/allexpirable.svg" style="width: 18%;" alt="no data found" />
          <h6 class="m-3 ps-5">No data found</h6>
        </div>
      </div>
    </div>
</div>



<button data-bs-toggle="modal" style="display: none;" data-bs-target="#viewLogs" id="viewLogsButton" #viewLogsButton></button>
<div class="modal blur-bg-2" id="viewLogs" tabindex="-1" aria-labelledby="viewEditLabel" data-bs-backdrop="static"
  aria-hidden="true">
  <div class="modal-dialog modal-custom modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header d-flex justify-content-between align-items-center">
        <div><b>Logs</b></div>
        <span class="pointer" style="margin-left: 12px;" (click)="refreshProviderLogs()">
          <i *ngIf="!logLoadingToggle" class="bi bi-arrow-repeat" style="font-size: 17px;color: #003fdaeb;"></i>
          <i *ngIf="logLoadingToggle" class="spinner-border spinner-border-sm" style="color: #003fdaeb;"></i>
        </span>
        <button type="button" class="btn-close" [disabled]="providerTestingToggle" data-bs-dismiss="modal" id="closeLogsButton" #closeLogsButton aria-label="Close" (click)="closeLogModel()"></button>
      </div>
      <div class="modal-body">
        <div>
          <table class="table" *ngIf="!logLoadingToggle && providerCrawlerLogList.length>0">
            <thead>
              <tr>
                <th style="width: 6%">S.No.</th>
                <th style="width: 20%">Lookup Name</th>
                <th style="width: 20%">Lookup Link</th>
                <th style="width: 8%" class="text-center">Status</th>
                <th style="width: 10%" class="text-center">State</th>
                <th style="width: 11%" class="text-center">Created Date</th>
                <th style="width: 10%" class="text-center">Re-run Count</th>
                <th style="width: 25%;" class="text-end text-center">Action</th>
              </tr>
            </thead>

            <tbody>
              <tr *ngFor="let log of providerCrawlerLogList; let i =index;">
                <td>
                  <div class="tableinfo">
                    {{i+1}}
                  </div>
                </td>
                <td>
                  <div class="tableinfo textClamp">
                    <span> {{log.lookupName}}</span>
                  </div>
                </td>
                <td>
                  <div class="tableinfo textClamp d-flex">
                    <span class="tbleditBtn text-primary"><i class="bi bi-box-arrow-up-left" style="cursor: pointer" (click)="routeToConfiguration(log)"></i></span>
                    <span>{{log.lookupLink}}</span>
                  </div>
                </td>
                <td>
                  <div class="tableinfo text-center">
                    <span *ngIf="log.errorStatus!=null" class="statusinactive">{{log.errorStatus?log.errorStatus:'N/A'}}</span>
                    <span *ngIf="log.errorStatus==null" [ngClass]="{'statusactive':log.crawlerStatus=='COMPLETED', 'statuspending' :log.crawlerStatus=='PENDING'}" >{{log.crawlerStatus}}</span>
                  </div>
                </td>
                <td>
                  <div class="tableinfo text-center">
                    <span>{{log.stateName?log.stateName:'----'}}</span>
                  </div>
                </td>
                <td>
                  <div class="tableinfo text-center">
                    <span class="badge-grey">{{log.createdDate | date:'MM-dd-yyyy hh:mm:ss' : 'EST'}}</span>
                  </div>
                </td>
                <td>
                  <div class="tableinfo text-center">
                    <span>{{log.reRunCount}}</span>
                  </div>
                </td>
                <td>
                  <div class="tableinfo d-flex align-items-center justify-content-end gap-2">
                    <Button tooltipClass="logTooltip" type="button" style="height: 33px;"
                     class="btn primaryBtn" [disabled]="log.reTestingToggle || providerTestingToggle || (Constant.EMPTY_STRINGS.includes(log.lookupName) && Constant.EMPTY_STRINGS.includes(log.lookupLink))"
                    (click)="testAgainProviderRequest(log.id, i)">Re-run
                      <i *ngIf="log.reTestingToggle" class="spinner-border spinner-border-sm"></i>
                      <h6 style="height: 9px;font-size: 1rem;"><i *ngIf="!log.reTestingToggle" class="bi bi-arrow-clockwise"></i></h6>
                    </Button>
                    <Button type="button" style="height: 33px;"
                      [disabled]="log.reTestingToggle || Constant.EMPTY_STRINGS.includes(log.snapShotUrl) || providerTestingToggle"
                      class="btn primaryBtn" (click)="viewSnapshot(log.snapShotUrl)">View
                      <h6 style="height: 9px;font-size: 1rem;"><i class="bi bi-eye pointer"></i></h6>
                    </Button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
          <!-- Empty notification -->
          <div class="empty-notific text-center" style="margin: 13% 10% 13% 3%;"
            *ngIf="!logLoadingToggle && providerCrawlerLogList.length==0">
            <div class="empty-notificinner">

              <img src="assets/images/allexpirable.svg" style="width: 25%;" alt="no data found" />
              <h6 class="m-3 ps-5">No data found</h6>
            </div>
          </div>
          <app-circular-loader *ngIf="logLoadingToggle"></app-circular-loader>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- show image modal -->
<button type="button" #openSnapshotModalButton id="openSnapshotModalButton" class="d-none" data-bs-toggle="modal"
  data-bs-target="#showImageModal"></button>
<div class="modal blur-bg-2" id="showImageModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false"
  aria-labelledby="shareModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" style="max-width:95%;">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Snapshot</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
          (click)="closeSnapshotModal()" #closeSnapshotModalButton id="closeSnapshotModalButton"></button>
      </div>
      <div class="modal-body text-center" style="overflow: scroll;min-height: 450px;">
        <img [src]="imageUrl | safe" alt="" />
      </div>
    </div>
  </div>
</div>
